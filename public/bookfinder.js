"use strict";var computeSlength=function(){app.selected.slength=app.oauth.shelves.filter(function(e){return e.name===app.selected.shelf})[0].book_count._},wSend=function(e,a,n){e.send(JSON.stringify({event:a,data:n}))},user=localStorage.getItem("user"),socket=new WebSocket("wss://"+location.host),app=new Vue({el:"#app",data:{oauth:null,books:[],loading:!0,selected:{shelf:null,lib:"BIPL",slength:null},bookfinding:!1,libraries:[{id:"AMKPL",name:"Ang Mo Kio Public Library"},{id:"BEPL",name:"Bedok Public Library"},{id:"BIPL",name:"Bishan Public Library"},{id:"BBPL",name:"Bukit Batok Public Library"},{id:"BMPL",name:"Bukit Merah Public Library"},{id:"BPPL",name:"Bukit Panjang Public Library"},{id:"CLL",name:"Central Public Library"},{id:"CSPL",name:"Cheng San Public Library"},{id:"CCKPL",name:"Choa Chu Kang Public Library"},{id:"CMPL",name:"Clementi Public Library"},{id:"GEPL",name:"Geylang East Public Library"},{id:"JRL",name:"Jurong Regional Library"},{id:"JWPL",name:"Jurong West Public Library"},{id:"LKCRL",name:"Lee Kong Chian Reference Library"},{id:"11LKCRL",name:"Lee Kong Chian Reference Library Level 11"},{id:"07LKCRL",name:"Lee Kong Chian Reference Library Level 7"},{id:"08LKCRL",name:"Lee Kong Chian Reference Library Level 8"},{id:"09LKCRL",name:"Lee Kong Chian Reference Library Level 9"},{id:"LSC",name:"Library Supply Centre"},{id:"LSCAV",name:"Library Supply Centre for AV"},{id:"CNPL",name:"Library@Chinatown"},{id:"EPPL",name:"Library@Esplanade"},{id:"OCPL",name:"Library@Orchard"},{id:"MPPL",name:"Marine Parade Public Library"},{id:"MOLLEY",name:"Mobile Bus"},{id:"LOLC",name:"NL Heritage"},{id:"PRPL",name:"Pasir Ris Public Library"},{id:"QUPL",name:"Queenstown Public Library"},{id:"SBPL",name:"Sembawang Public Library"},{id:"SKPL",name:"Sengkang Public Library"},{id:"SRPL",name:"Serangoon Public Library"},{id:"TRL",name:"Tampines Regional Library"},{id:"TPPL",name:"Toa Payoh Public Library"},{id:"WRL",name:"Woodlands Regional Library"},{id:"YIPL",name:"Yishun Public Library"}]},methods:{login:function(){this.$http.get("/login").then(function(e){"url"in e.body&&(window.location.href=e.body.url.url),"error"in e.body&&console.error(e.body.error)},function(e){console.error(e)})},checkShelf:function(){app.bookfinding=!0,wSend(socket,"getBooks",{user:app.oauth,selected:app.selected})},openBook:function(e){window.location.href=e[0].url}},watch:{"selected.shelf":computeSlength}});null===user?app.login():(app.oauth=JSON.parse(user),socket.addEventListener("open",function(e){wSend(socket,"retrieveUser",app.oauth)}),socket.addEventListener("message",function(e){var a=JSON.parse(e.data);switch(console.log(a),a.event){case"sendUser":app.loading=!1,Object.assign(app.oauth,a.data),app.selected.shelf=app.oauth.shelves[2].name,computeSlength(),app.checkShelf();break;case"sendBooks":app.books.push(a.data);break;case"endBooks":app.bookfinding=!1,app.books=a.data;break;case"error":console.error(a.data)}}));